# Copy this into your RHDH dynamic-plugins file.

includes:
  - dynamic-plugins.default.yaml

plugins:
  # Github Actions
  - package: ./dynamic-plugins/dist/backstage-community-plugin-github-actions
    disabled: false
  # Gitlab Backend
  - package: ./dynamic-plugins/dist/immobiliarelabs-backstage-plugin-gitlab-backend-dynamic
    disabled: false

  # RBAC
  - package: ./dynamic-plugins/dist/backstage-community-plugin-rbac
    disabled: false
  - package: ./dynamic-plugins/dist/backstage-community-plugin-rbac-backend-dynamic
    disabled: false

  # Azure-DevOps
  - package: ./dynamic-plugins/dist/backstage-community-plugin-azure-devops
    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          backstage-community.plugin-azure-devops:
            mountPoints:
              - mountPoint: entity.page.ci/cards
                importName: EntityAzurePipelinesContent
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    anyOf:
                      - hasAnnotation: dev.azure.com/project
                      - hasAnnotation: dev.azure.com/build-definition

  - package: ./dynamic-plugins/dist/backstage-community-plugin-azure-devops-backend-dynamic
    disabled: false

    # Gitlab
  - package: ./dynamic-plugins/dist/immobiliarelabs-backstage-plugin-gitlab
    disabled: false
#    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          immobiliarelabs.backstage-plugin-gitlab:
            mountPoints:
              - mountPoint: entity.page.ci/cards
                importName: EntityGitlabPipelinesTable
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    allOf:
                      - isGitlabAvailable
                      - hasAnnotation: 
                          - gitlab.com/project-slug
              - mountPoint: entity.page.issues/cards
                importName: EntityGitlabIssuesTable
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    allOf:
                      - isGitlabAvailable
              - mountPoint: entity.page.pull-requests/cards
                importName: EntityGitlabMergeRequestsTable
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    allOf:
                      - isGitlabAvailable

  # Quay plugin
  - package: oci://<registry>/<username>/<repository>:release-x.y!tssc-plugins-backstage-community-plugin-quay
    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          tssc-plugins.backstage-community-plugin-quay:
            mountPoints:
              - mountPoint: entity.page.ci/cards
                importName: QuayPage
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    allOf:
                      - isQuayAvailable

  - package: oci://<registry>/<username>/<repository>:release-x.y!tssc-plugins-backstage-community-plugin-quay-backend
    disabled: false

  # K8s
  - package: ./dynamic-plugins/dist/backstage-plugin-kubernetes
    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          backstage.plugin-kubernetes:
            mountPoints:
              - mountPoint: entity.page.kubernetes/cards
                importName: EntityKubernetesContent
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    anyOf:
                      - hasAnnotation: backstage.io/kubernetes-id
                      - hasAnnotation: backstage.io/kubernetes-namespace


  - package: ./dynamic-plugins/dist/backstage-plugin-kubernetes-backend-dynamic
    disabled: false

  # TEKTON
  - package: oci://<registry>/<username>/<repository>:release-x.y!tssc-plugins-backstage-community-plugin-tekton
    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          tssc-plugins.backstage-community-plugin-tekton:
            mountPoints:
            - config:
                if:
                  allOf:
                  - isTektonCIAvailable
                layout:
                  gridColumn: 1 / -1
                  gridRowStart: 1
              importName: TektonCI
              mountPoint: entity.page.ci/cards 

  # Jenkins
  - package: ./dynamic-plugins/dist/backstage-community-plugin-jenkins
    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          backstage-community.plugin-jenkins:
            mountPoints:
              - mountPoint: entity.page.ci/cards
                importName: EntityJenkinsContent
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    anyOf:
                      - isJenkinsAvailable
              - mountPoint: entity.page.ci/cards
                importName: EntityLatestJenkinsRunCard
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    anyOf:
                      - isJenkinsAvailable

  - package: ./dynamic-plugins/dist/backstage-community-plugin-jenkins-backend-dynamic
    disabled: false

  # ArgoCD
  - package: oci://<registry>/<username>/<repository>:release-x.y!tssc-plugins-backstage-community-plugin-redhat-argocd
    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          backstage-community.plugin-redhat-argocd:
          #tssc-plugins.backstage-community-plugin-redhat-argocd:
            mountPoints:
              - mountPoint: entity.page.ci/cards
                importName: ArgocdDeploymentLifecycle
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    allOf:
                      - isArgocdConfigured

              - mountPoint: entity.page.ci/cards
                importName: ArgocdDeploymentSummary
                config:
                  layout:
                    gridColumn: 1 / -1
                  if:
                    allOf:
                      - isArgocdConfigured


  # ArgoCD Backend
  - package: oci://<registry>/<username>/<repository>:release-x.y!tssc-plugins-backstage-community-plugin-redhat-argocd-backend
    disabled: false

  # MSSV
  - package: oci://<registry>/<username>/<repository>:release-x.y!tssc-plugins-backstage-community-plugin-multi-source-security-viewer-dynamic
    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          tssc-plugins.backstage-community-plugin-multi-source-security-viewer:
            mountPoints:
              - config:
                  layout:
                    gridColumn: 1 / -1
                    gridRowStart: 2
                  if:
                    allOf:
                      - isMultiCIAvailable
                importName: EntityMultiCIPipelinesContent
                mountPoint: entity.page.ci/cards
